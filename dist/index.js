!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i={topics:{},publish(t,...e){this.topics[t]&&this.topics[t].forEach(t=>{t(...e)})},subscribe(t,e){this.topics[t]||(this.topics[t]=[]),this.topics[t].push(e)}};e.default=i},function(t,e,s){"use strict";function i(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);i(s(3)),i(s(4)),i(s(5)),i(s(6));let r=new n.ECS;console.log(r)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.ECS=class{constructor(){this.isRunning=!1,this.entities=[],this.systems=[],this.inactiveSystems=[],this.afterUpdateEvents=[],this._subscribe()}update(t){this.isRunning=!0,this.systems.forEach(e=>{e.tick(t)}),this._afterSystemsUpdate(),this._removeMarkedEntities()}addEntity(t){return t.id=this._nextId(),this._runOrPushToAfterUpdateStack(this._addEntity,t),t.id}removeEntity(t){this._runOrPushToAfterUpdateStack(this._removeEntity,t)}addSystem(t){return t.id=this._nextId(),this._runOrPushToAfterUpdateStack(this._addSystem,t),t.id}removeSystem(t){this._runOrPushToAfterUpdateStack(this._removeSystem,t)}_runOrPushToAfterUpdateStack(t,...e){t=t.bind(this),this.isRunning?this.afterUpdateEvents.push(()=>t(...e)):t(...e)}_addSystem(t){this.systems.push(t)}_removeSystem(t){let e=this.systems.findIndex(e=>t===e.id);e||(e=this.inactiveSystems.findIndex(e=>t===e.id)),this.systems.splice(e,1)}_addEntity(t){this.entities.push(t),i.default.publish("onCreateEntity",t)}_removeEntity(t){let e=this.entities.findIndex(e=>e.id===t);e<0||(this.entities.splice(e,1),i.default.publish("onRemoveEntity",t))}_afterSystemsUpdate(){this.afterUpdateEvents.forEach(t=>{t()}),this.afterUpdateEvents=[]}_nextId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}_subscribe(){i.default.subscribe("onDisableSystem",t=>{this._runOrPushToAfterUpdateStack(()=>{let e=this.systems.findIndex(e=>e.id===t);this.inactiveSystems.push(this.systems[e]),this.systems.splice(e,1)})}),i.default.subscribe("onEnableSystem",t=>{this._runOrPushToAfterUpdateStack(()=>{let e=this.inactiveSystems.findIndex(e=>e.id===t);this.systems.push(this.inactiveSystems[e]),this.inactiveSystems.splice(e,1)})})}_removeMarkedEntities(){this.entities.filter(t=>t.shouldBeRemoved()).forEach(t=>{this.removeEntity(t.id)})}__getEntities(){return this.entities}__getSystems(){return this.systems}__getInactiveSystems(){return this.inactiveSystems}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.ECS=class{constructor(){this.isRunning=!1,this.entities=[],this.systems=[],this.inactiveSystems=[],this.afterUpdateEvents=[],this._subscribe()}update(t){this.isRunning=!0,this.systems.forEach(e=>{e.tick(t)}),this._afterSystemsUpdate(),this._removeMarkedEntities()}addEntity(t){return t.id=this._nextId(),this._runOrPushToAfterUpdateStack(this._addEntity,t),t.id}removeEntity(t){this._runOrPushToAfterUpdateStack(this._removeEntity,t)}addSystem(t){return t.id=this._nextId(),this._runOrPushToAfterUpdateStack(this._addSystem,t),t.id}removeSystem(t){this._runOrPushToAfterUpdateStack(this._removeSystem,t)}_runOrPushToAfterUpdateStack(t,...e){t=t.bind(this),this.isRunning?this.afterUpdateEvents.push(()=>t(...e)):t(...e)}_addSystem(t){this.systems.push(t)}_removeSystem(t){let e=this.systems.findIndex(e=>t===e.id);e||(e=this.inactiveSystems.findIndex(e=>t===e.id)),this.systems.splice(e,1)}_addEntity(t){this.entities.push(t),i.default.publish("onCreateEntity",t)}_removeEntity(t){let e=this.entities.findIndex(e=>e.id===t);e<0||(this.entities.splice(e,1),i.default.publish("onRemoveEntity",t))}_afterSystemsUpdate(){this.afterUpdateEvents.forEach(t=>{t()}),this.afterUpdateEvents=[]}_nextId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}_subscribe(){i.default.subscribe("onDisableSystem",t=>{this._runOrPushToAfterUpdateStack(()=>{let e=this.systems.findIndex(e=>e.id===t);this.inactiveSystems.push(this.systems[e]),this.systems.splice(e,1)})}),i.default.subscribe("onEnableSystem",t=>{this._runOrPushToAfterUpdateStack(()=>{let e=this.inactiveSystems.findIndex(e=>e.id===t);this.systems.push(this.inactiveSystems[e]),this.inactiveSystems.splice(e,1)})})}_removeMarkedEntities(){this.entities.filter(t=>t.shouldBeRemoved()).forEach(t=>{this.removeEntity(t.id)})}__getEntities(){return this.entities}__getSystems(){return this.systems}__getInactiveSystems(){return this.inactiveSystems}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.EcsComponent=class{constructor(t){this._type=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.EcsEntity=class{constructor(t){this.id="",this.remove=!1,this.components=[],this.componentTypes={},this.components=t,this.components.forEach(t=>{this.componentTypes[t._type]=!0})}markForRemove(){this.remove=!0}shouldBeRemoved(){return this.remove}hasComponent(t){return!!this.componentTypes[t]}getComponent(t){let e=this.components.find(e=>e._type===t);if(!e)throw new Error(`Entity with id: ${this.id} doesn't have component: ${t}`);return e}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.EcsSystem=class{constructor(t){this.componentTypes=t,this.id="",this.isActive=!0,this.systemEntities=[],this._subscribe()}setComponentTypes(t){this.componentTypes=t}setIsActive(t){this.isActive=t,i.default.publish(t?"onEnableSystem":"onDisableSystem",this.id)}getIsActive(){return this.isActive}setEntities(t){this.systemEntities=[],this.systemEntities=t.filter(this._isEntityForSystem.bind(this))}_isEntityForSystem(t){return!!this.componentTypes.some(e=>t.hasComponent(e))&&!this.systemEntities.some(e=>t.id===e.id)}_subscribe(){i.default.subscribe("onCreateEntity",t=>{this._isEntityForSystem(t)&&this.systemEntities.push(t)}),i.default.subscribe("onRemoveEntity",t=>{let e=this.systemEntities.findIndex(e=>e.id===t);e<0||this.systemEntities.splice(e,1)})}__getComponentTypes(){return this.componentTypes}__getSystemEntities(){return this.systemEntities}}}]);